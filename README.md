# ProcessDesignAgents

ProcessDesignAgents is a multi-agent workflow for conceptual chemical-process design. Each agent is responsible for a portion of the engineering study—from requirement extraction through stream definition, equipment sizing, safety review, and gate approval. The project is inspired by the multi-agent patterns popularised by the [TradingAgents](https://github.com/TauricResearch/TradingAgents) project and adapts those ideas to process engineering.

## Key Features

-   **Graph Orchestrated Agents** – A `langgraph` state machine coordinates requirement analysis, concept detailing, stream definition, equipment sizing, safety review, and project management. Pass `manual_concept_selection=True` to `ProcessDesignGraph.propagate(...)` if you want to intervene before the detailer locks in a concept.
-   **Structured Artefacts** – Intermediate outputs (requirements, component lists, design basis, flowsheet narrative) are emitted as Markdown and JSON so downstream tools stay in sync with the shared `DesignState`.
-   **On-Demand Equipment/Stream Merge** – Equipment and stream artefacts live in separate state fields and are merged only when prompts or reports require the combined view, keeping memory lean while preserving the Markdown tables generated by `equipments_and_streams_dict_to_markdown`.
-   **Tool-Assisted Sizing** – Built-in sizing tools cover preliminary heat-exchanger and pump calculations and can be extended by registering additional helpers in the graph tool node.
-   **Markdown & Word Exports** – Aggregated reports can be saved to Markdown or DOCX using a Pandoc-powered export with a customizable template.
-   **CLI Visualisation** – The CLI (`cli/main.py`) streams agent status, tool calls, and report sections as they are produced.

## Project Layout

```
ProcessDesignAgents/
├─ README.md
├─ requirements.txt
├─ main.py
├─ processdesignagents/
│  ├─ agents/              # Analyst, researcher, designer, and PM agents
│  ├─ graph/               # Graph wiring and propagator
│  ├─ utils/               # Shared helpers and LLM utilities
│  └─ default_config.py
├─ cli/                    # Rich-based command-line viewer
├─ docs/
   ├─ ARCHITECTURE.md      # High-level architecture & dataflow
   └─ AGENTS.md            # Responsibilities and prompts for each agent
└─ examples/
   └─ reports/             # Sample project reports generated by the agents
```

Additional documentation is available under `docs/`. Contributor-specific practices are captured in `AGENTS.md`. Sample end-to-end outputs live in `examples/`.

## Getting Started

### Prerequisites

-   Python 3.10+
-   Recommended: virtual environment (e.g. `python -m venv venv`)

### Installation

```bash
git clone https://github.com/may3rd/ProcessDesignAgents.git
cd ProcessDesignAgents
pip install -r requirements.txt
```

Set any required API keys for your LLM provider (e.g. `OPENROUTER_API_KEY`) in your environment or `.env`.

## Running the Workflow

### CLI Visualization

```bash
python -m cli.main -p "Design a small biodiesel process..."
```

Pass your problem statement with `-p/--prompt`. The CLI streams agent progress, tool invocations, and compiled reports using Rich panels.

### Report Exports

`ProcessDesignGraph.propagate(...)` accepts `save_markdown` and `save_word_doc` arguments. The DOCX path uses Pandoc (via `pypandoc`) together with `python-docx` and a reference template located at `reports/template.docx`. Update that template to change fonts or company styling. Ensure that:

-   Pandoc is installed and available on your `PATH`.
-   `pypandoc` and `python-docx` are installed in your environment.
-   `config["save_dir"]` points to the directory that contains the template.

Both Markdown and Word outputs are created automatically when the associated arguments are provided. The run will resume automatically from the last unfinished checkpoint for the same problem statement; pass `resume_from_last_run=False` if you need to start fresh.

Every workflow run writes the final `DesignState` snapshot to `eval_results/ProcessDesignAgents_logs/full_states_log.json`, including an on-the-fly `equipment_and_stream_combined` field for debugging or downstream exports.

## Examples

Browse `examples/reports/` for sample end-to-end design packages generated by the agents. Each Markdown file mirrors the structure of the aggregated final report, making it a quick way to understand expected outputs before running your own briefs.

## Agent Pipeline (Default Graph)

1. **Process Requirements Analyst** – Extracts structured requirements from the problem statement.
2. **Innovative Researcher** – Brainstorms potential process concepts.
3. **Conservative Researcher** – Refines and validates potential process concepts.
4. **Concept Detailer** – Selects the most feasible concept and builds a detailed brief.
5. **Component List Researcher** – Produces a consolidated component inventory for downstream use.
6. **Design Basis Analyst** – Writes the design basis referencing the concept detail and component list.
7. **Flowsheet Design Agent** – Produces the conceptual flowsheet narrative (including preliminary equipment and stream tables) in Markdown.
8. **Equipment & Stream Catalog Agent** – Seeds the equipment and stream templates that downstream agents enrich independently.
9. **Stream Property Estimation Agent** – Populates the standalone stream list with reconciled properties while leaving the equipment template untouched.
10. **Equipment Sizing Agent** – Calls sizing tools, updates the equipment list, and writes notes without duplicating stream data.
11. **Safety & Risk Analyst** – Performs a HAZOP-style review.
12. **Project Manager** – Compiles the final approval report.

The graph wiring lives in `processdesignagents/graph/setup.py`. State fields are defined in `processdesignagents/agents/utils/agent_states.py`.

## Tooling & Extensions

The sizing tools live under `processdesignagents/agents/utils/` and are registered in `ProcessDesignGraph._create_tool_nodes()`. Out of the box the graph exposes `size_heat_exchanger_basic` and `size_pump_basic`; add new preliminary tools (e.g., compressor sizing) by importing them alongside these functions and extending the tool node mapping.

## Development

-   **Tests**: Add unit tests under `tests/` (not yet provided) and run with `pytest`.
-   **Formatting**: Follow `black`/`isort` style conventions if you add CI.
-   **Docs**: Update `docs/` when the graph or agent prompts change.

## Citation

If you use this repository, please cite both ProcessDesignAgents and the inspiration source TradingAgents:

```
ProcessDesignAgents. 2025. https://github.com/may3rd/ProcessDesignAgents.
TradingAgents. 2025. https://github.com/TauricResearch/TradingAgents.
```

## License

MIT License (see `LICENSE`, if provided).
